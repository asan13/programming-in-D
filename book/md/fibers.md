# Файберы

Файбер - поток выполнения, при помощи корого оединственный поток может
выполнять несколько задач. Переключение между файберами более еффективно,
чем переключение обычных потоков, обычно используюмых для многозадачности.

Поток с файберами содержит несколько _стеков вызова_. Поэтому, что бы понять
и оценить файберы, нужно понимать, что предствляет собой _стек вызова_
потока.

## Стек вызовов

Параметры, нестатические локальные переменные, возвращаемое значение,
временные функциональные выражения, а также любая дополнительная информация,
корорая может потребоваться во время выполнения функции, представляет собой
_локальное состояние_ этой функции. При каждом вызове функции происходит
автоматическое выделение памяти и инициализация локального состояния.

Пространство, выделенное для хранения локального состояния при вызове функции, 
называется _фреймом_ (или _стековым фреймом_). Поскольку функция  вызывает 
другие функции при выполнении в потоке, их фреймы концептуально размещаются 
друг над другом, образую стек фреймов. Стек фреймов текущих активных функций
называется _стеком вызовов_.

Например, когда основной поток следующей программы запускает функцию 
**bar()**, будет существовать три уровня активных вызовов функций,
поскольку **main()** вызывает **foo()**, а **foo()** вызывает **bar()**:

```d
void main() {
    int a;
    int b;

    int c = foo(a, b);
}

int foo(int x, int y) {
    bar(x + y);
    return 42;
}

void bar(int param) {
    string[] arr;
    // ...
}
```

Во время выполнения **bar()** стек вызовов содержит три фрейма, хранящих
локальное состояние этих текущих активных вызовов:

```
Стек вызовов растет вверх по
мере роста глубины вложенности
вызовов функций.                 ▲  ▲
                                 │  │
   Вершина стека вызовов → ┌──────────────┐
                           │ int param    │ ← фрейм bar
                           │ string[] arr │
                           ├──────────────┤
                           │ int x        │
                           │ int y        │ ← фрейм foo
                           │ return value │
                           ├──────────────┤
                           │ int a        │
                           │ int b        │ ← фрайм main
                           │ int c        │
Bottom of the call stack → └──────────────┘
```
